let t=(t,o)=>Math.floor(Math.random()*(o-t+1))+t;function o(t){for(var o=t.length-1;o>0;o--){var e=Math.floor(Math.random()*(o+1)),r=t[o];t[o]=t[e],t[e]=r}}class WorkerBot{constructor(t,o){this.storageSize=0,this.storage="",this.color=""}performAction(t,o){}sendMessage(t){}}class ControllerBot{constructor(t){this.name="",this.storage=""}sendMessage(t,o){return[]}}class WorkerBotWrapper{constructor(t,o,e){this.x=t,this.y=o,this.gold=0,this.bot=new e(t,o),this.name=e.name,this.stunnedRound=-1}performAction(t,o){this.bot.performAction(t,o)}sendMessage(t){this.bot.sendMessage(t)}}const e=100,r=10,n=20;class Controller{constructor(t,o){this.displayFunc=o,this.botClasses=t.filter(t=>t.controllerBot.prototype instanceof ControllerBot&&t.workerBot.prototype instanceof WorkerBot)}runGame(){this.initGrid(),o(this.botnets),this.botnets=this.botnets.slice(0,15);for(let t=0;t<1e3;t++)this.runRound(t);return this.botnets.sort((t,o)=>t.gold-o.gold).map((t,o)=>"".concat(o+1,". ").concat(t.controllerBot.name,":").concat(t.workerBots.reduce((t,o)=>t.gold+o.gold,0)," Gold")).join("\n")}runRound(t){console.log(t);for(let t=0;t<r;t++)this.generateCoin();o(this.botnets);let e=this.botnets.flatMap(t=>t.workerBots);for(let o of this.botnets)for(let r=0;r<o.workerBots.length;r++){let n=o.workerBots[r];if(-1!==n.stunnedRound||n.stunnedRound===t-1){n.stunnedRound=0;let t=e.map(t=>t.sendMessage(this.getSurrondings(t.x,t.y))),s=o.controllerBot.sendMessage(t,r),i=n.performAction(s);this.handleAction(i,n)||console.log("Invalid Action(".concat(i,")"))}else console.log("EMP'd")}}initGrid(){this.grid=new Array(100);for(let t=0;t<100;t++)this.grid[t]=new Array(100);this.botnets=this.botClasses.map(t=>{let o=[];for(let e=0;e<n;e++)o.push(this.generateWorkerBot(t.workerBot));return{controllerBot:new t.controllerBot(o.map(t=>[t.x,t.y])),workerBots:o}});for(let t=0;t<e;t++)this.generateCoin()}handleAction(t,o){switch(t[0]){case"kill":if([6,7,8,11,12,13,16,17,18].includes(t[1])){let e=this.surrondingsIndexToCoords(t[1]),r=this.grid[e[1]][e[0]];if(r instanceof WorkerBotWrapper){let t=Math.floor(r.gold);return console.log("".concat(o.name," killed ").concat(r.name," for ").concat(t," gold")),o.gold+=t,r=void 0,!0}return!1}return!1;case"move":if(t[1]>=0&&t[1]<=24){let e=this.surrondingsIndexToCoords(t[1]),r=this.grid[e[1]][e[0]];return void 0===r&&(this.grid[o.y][o.x]=void 0,r=o,[o.x,o.y]=e,!0)}return!1;case"emp":throw new TypeError("emp not implemented")}}generateCoin(){let o=t(0,99),e=t(0,99);void 0===this.grid[e][o]?this.grid[e][o]="C":this.generateCoin()}generateWorkerBot(o){let e=t(0,99),r=t(0,99);if(void 0===this.grid[r][e]){let t=new WorkerBotWrapper(e,r,o);return this.grid[r][e]=t,t}return this.generateWorkerBot()}getSurrondings(t,o){let e=[];for(let r=-2;r<=2;r++)for(let n=-2;n<=2;n++)e.push(this.grid[o+r][t+n]);return e}surrondingsIndexToCoords(t,o,e){return[t%5-2+o,Math.floor(t/5)-2+e]}display(){this.displayFunc(this.grid)}}onmessage=function(t){let o=t[0];new Controller(o,postMessage).runGame()};
//# sourceMappingURL=worker.js.map
