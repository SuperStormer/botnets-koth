{"version":3,"file":"worker.js","sources":["../../src/scripts/utils.js","../../src/scripts/WorkerBot.js","../../src/scripts/ControllerBot.js","../../src/scripts/WorkerBotWrapper.js","../../src/scripts/Controller.js","../../src/scripts/worker.js"],"sourcesContent":["//from https://stackoverflow.com/a/1527820/\r\nlet randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;\r\n//from https://stackoverflow.com/a/12646864/7941251\r\nfunction shuffle(array) {\r\n\t//in place\r\n\tarray;\r\n\tfor (var i = array.length - 1; i > 0; i--) {\r\n\t\tvar j = Math.floor(Math.random() * (i + 1));\r\n\t\tvar temp = array[i];\r\n\t\tarray[i] = array[j];\r\n\t\tarray[j] = temp;\r\n\t}\r\n}\r\nfunction sleep(timeout) {\r\n\t// eslint-disable-next-line no-unused-vars\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tsetTimeout(resolve, timeout);\r\n\t});\r\n}\r\nexport { randInt, shuffle, sleep };\r\n","/*eslint no-unused-vars:0*/\r\nclass WorkerBot {\r\n\tconstructor(index) {\r\n\t\tthis.index = index;\r\n\t}\r\n\tperformAction(message) {}\r\n\tsendMessage(x, y, surroundings) {}\r\n}\r\n/*let oldHasInstance = WorkerBot[Symbol.hasInstance].bind({});\r\nObject.defineProperty(WorkerBot, Symbol.hasInstance, {\r\n\tvalue: function(instance) {\r\n\t\treturn instance instanceof WorkerBotWrapper || oldHasInstance;\r\n\t}\r\n});*/\r\nexport default WorkerBot;\r\n","/*eslint no-unused-vars:0*/\r\nexport default class ControllerBot {\r\n\tconstructor(locations) {\r\n\t\tthis.storage = \"\";\r\n\t}\r\n\tsendMessage(messages, index) {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n","/*eslint no-unused-vars:0*/\r\nexport default class WorkerBotWrapper {\r\n\tconstructor(x, y, index, name, color, botClass) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.index = index;\r\n\t\tthis.gold = 0;\r\n\t\tthis.color = color;\r\n\t\tthis.bot = new botClass(index);\r\n\t\tthis.name = `${name}#${index}`;\r\n\t\tthis.stunnedRound = undefined;\r\n\t\tthis.alive = true;\r\n\t}\r\n\tperformAction(message) {\r\n\t\treturn this.bot.performAction(message);\r\n\t}\r\n\tsendMessage(x, y, surrondings) {\r\n\t\treturn this.bot.sendMessage(x, y, surrondings);\r\n\t}\r\n}\r\n","import { randInt, shuffle, sleep } from \"./utils.js\";\r\nimport WorkerBot from \"./WorkerBot.js\";\r\nimport ControllerBot from \"./ControllerBot.js\";\r\nimport WorkerBotWrapper from \"./WorkerBotWrapper.js\";\r\nconst STARTING_COINS = 100;\r\nconst COINS_PER_ROUND = 10;\r\nconst NUM_WORKER_BOTS = 20;\r\nexport default class Controller {\r\n\tconstructor(botClasses, displayFunc, rounds = 1000, displayInterval = 100) {\r\n\t\tthis.rounds = rounds;\r\n\t\tthis.displayFunc = displayFunc;\r\n\t\tthis.displayInterval = displayInterval;\r\n\t\tthis.botClasses = botClasses.filter(\r\n\t\t\tbotClasses2 =>\r\n\t\t\t\tbotClasses2.controllerBot.prototype instanceof ControllerBot &&\r\n\t\t\t\tbotClasses2.workerBot.prototype instanceof WorkerBot\r\n\t\t);\r\n\t}\r\n\tasync runGame() {\r\n\t\tthis.initGrid();\r\n\t\tshuffle(this.botnets);\r\n\t\tthis.botnets = this.botnets.slice(0, 15);\r\n\t\tfor (let i = 0; i < this.rounds; i++) {\r\n\t\t\tawait this.runRound(i);\r\n\t\t}\r\n\t\treturn this.botnets\r\n\t\t\t.sort((a, b) => a.gold - b.gold)\r\n\t\t\t.map(\r\n\t\t\t\t(botnet, i) =>\r\n\t\t\t\t\t`${i + 1}. ${botnet.name}:${botnet.workerBots.reduce(\r\n\t\t\t\t\t\t(a, b) => a + b.gold,\r\n\t\t\t\t\t\t0\r\n\t\t\t\t\t)} Gold`\r\n\t\t\t)\r\n\t\t\t.join(\"\\n\");\r\n\t}\r\n\tasync runRound(round) {\r\n\t\tconsole.log(`Round #${round}`);\r\n\t\tfor (let i = 0; i < COINS_PER_ROUND; i++) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.generateCoin();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.warn(\"No free space for coins\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tshuffle(this.botnets);\r\n\t\tlet workerBots = this.botnets.flatMap(botnet => botnet.workerBots);\r\n\t\tfor (let botnet of this.botnets) {\r\n\t\t\tfor (let i = 0; i < botnet.workerBots.length; i++) {\r\n\t\t\t\tlet workerBot = botnet.workerBots[i];\r\n\t\t\t\tif (workerBot.alive) {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tworkerBot.stunnedRound === undefined ||\r\n\t\t\t\t\t\tworkerBot.stunnedRound === round - 1\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tworkerBot.stunnedRound = undefined;\r\n\t\t\t\t\t\tlet allMessages = workerBots.map(workerBot2 =>\r\n\t\t\t\t\t\t\tworkerBot2.sendMessage(\r\n\t\t\t\t\t\t\t\tworkerBot2.x,\r\n\t\t\t\t\t\t\t\tworkerBot2.y,\r\n\t\t\t\t\t\t\t\tthis.getSurroundings(workerBot2.x, workerBot2.y)\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tlet controllerBotMessage = botnet.controllerBot.sendMessage(\r\n\t\t\t\t\t\t\tallMessages,\r\n\t\t\t\t\t\t\ti\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet action = workerBot.performAction(\r\n\t\t\t\t\t\t\t\tcontrollerBotMessage\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (!this.handleAction(action, workerBot)) {\r\n\t\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t\t`${workerBot.name} made an invalid action(${action})`\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\tconsole.error(\r\n\t\t\t\t\t\t\t\t`${workerBot.name} threw this exception with this message: ${controllerBotMessage}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconsole.error(error.stack);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//emp'd\r\n\t\t\t\t\t\tconsole.log(`${workerBot.name} was EMP'd`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.display();\r\n\t\tawait sleep(this.displayInterval);\r\n\t}\r\n\tinitGrid() {\r\n\t\tthis.grid = new Array(100); //indexed [y,x]\r\n\t\tfor (let i = 0; i < 100; i++) {\r\n\t\t\tthis.grid[i] = new Array(100).fill(\"\");\r\n\t\t}\r\n\t\tthis.botnets = this.botClasses.map(botClasses2 => {\r\n\t\t\tlet workerBots = [];\r\n\t\t\tfor (let i = 0; i < NUM_WORKER_BOTS; i++) {\r\n\t\t\t\tworkerBots.push(\r\n\t\t\t\t\tthis.generateWorkerBot(\r\n\t\t\t\t\t\ti,\r\n\t\t\t\t\t\tbotClasses2.name,\r\n\t\t\t\t\t\tbotClasses2.color,\r\n\t\t\t\t\t\tbotClasses2.workerBot\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tlet controllerBot = new botClasses2.controllerBot(\r\n\t\t\t\tworkerBots.map(bot => [bot.x, bot.y])\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\tname: botClasses2.name,\r\n\t\t\t\tcontrollerBot,\r\n\t\t\t\tworkerBots\r\n\t\t\t};\r\n\t\t});\r\n\t\tfor (let i = 0; i < STARTING_COINS; i++) {\r\n\t\t\tthis.generateCoin();\r\n\t\t}\r\n\t}\r\n\thandleAction(action, bot) {\r\n\t\t//returns true if action was valid\r\n\t\tswitch (action[0]) {\r\n\t\t\tcase \"kill\":\r\n\t\t\t\treturn this.handleKill(action[1], bot);\r\n\t\t\tcase \"move\":\r\n\t\t\t\treturn this.handleMove(action[1], bot);\r\n\t\t\tcase \"emp\":\r\n\t\t\t\tthrow new TypeError(\"emp not implemented\");\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(`${bot.name} skipped its turn`);\r\n\t\t}\r\n\t}\r\n\thandleKill(param, bot) {\r\n\t\tif ([6, 7, 8, 11, 13, 16, 17, 18].includes(param)) {\r\n\t\t\tlet coords = this.surroundingsIndexToCoords(param, bot.x, bot.y);\r\n\t\t\tlet square;\r\n\t\t\ttry {\r\n\t\t\t\tsquare = this.grid[coords[1]][coords[0]];\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t`${bot.name} tried to kill an invalid location(${coords})`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (square instanceof WorkerBotWrapper) {\r\n\t\t\t\tlet gold = Math.floor(square.gold);\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t`${bot.name} killed ${square.name} for ${gold} gold`\r\n\t\t\t\t);\r\n\t\t\t\tbot.gold += gold;\r\n\t\t\t\tthis.grid[coords[1]][coords[0]] = \"\";\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.kill(coords[0], coords[1]);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(coords);\r\n\t\t\t\t\tconsole.error(bot);\r\n\t\t\t\t\tconsole.error(square);\r\n\t\t\t\t\tconsole.error(this.botnets);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if (param === 12) {\r\n\t\t\tconsole.log(`${bot.name} commited suicide`);\r\n\t\t\tthis.kill(bot.x, bot.y);\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\thandleMove(param, bot) {\r\n\t\tif ([6, 7, 8, 11, 13, 16, 17, 18].includes(param)) {\r\n\t\t\tlet coords = this.surroundingsIndexToCoords(param, bot.x, bot.y);\r\n\t\t\tlet square;\r\n\t\t\ttry {\r\n\t\t\t\tsquare = this.grid[coords[1]][coords[0]];\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t`${bot.name} tried to move to an invalid location(${coords})`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (square === \"\" || square === \"C\") {\r\n\t\t\t\tif (square === \"C\") {\r\n\t\t\t\t\tbot.gold++;\r\n\t\t\t\t}\r\n\t\t\t\tthis.grid[bot.y][bot.x] = \"\";\r\n\t\t\t\tthis.grid[coords[1]][coords[0]] = bot;\r\n\t\t\t\t[bot.x, bot.y] = coords;\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if (param === 12) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tkill(x, y) {\r\n\t\tlet bot = this.botnets\r\n\t\t\t.flatMap(botnet => botnet.workerBots)\r\n\t\t\t.find(bot => bot.x === x && bot.y === y);\r\n\t\tbot.alive = false;\r\n\t}\r\n\tgenerateCoin() {\r\n\t\tlet x = randInt(0, 99);\r\n\t\tlet y = randInt(0, 99);\r\n\t\tif (this.grid[y][x] === \"\") {\r\n\t\t\tthis.grid[y][x] = \"C\";\r\n\t\t} else {\r\n\t\t\tthis.generateCoin();\r\n\t\t}\r\n\t}\r\n\tgenerateWorkerBot(index, name, color, workerBotClass) {\r\n\t\tlet x = randInt(0, 99);\r\n\t\tlet y = randInt(0, 99);\r\n\t\tif (this.grid[y][x] === \"\") {\r\n\t\t\tlet bot = new WorkerBotWrapper(\r\n\t\t\t\tx,\r\n\t\t\t\ty,\r\n\t\t\t\tindex,\r\n\t\t\t\tname,\r\n\t\t\t\tcolor,\r\n\t\t\t\tworkerBotClass\r\n\t\t\t);\r\n\t\t\tthis.grid[y][x] = bot;\r\n\t\t\treturn bot;\r\n\t\t} else {\r\n\t\t\treturn this.generateWorkerBot(index, name, color, workerBotClass);\r\n\t\t}\r\n\t}\r\n\tgetSurroundings(x, y) {\r\n\t\tlet surroundings = [];\r\n\t\tfor (let i = -2; i <= 2; i++) {\r\n\t\t\tfor (let j = -2; j <= 2; j++) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsurroundings.push(this.grid[y + i][x + j]);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tsurroundings.push(\"E\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn surroundings.map(square =>\r\n\t\t\tsquare instanceof WorkerBotWrapper ? \"B\" : square\r\n\t\t);\r\n\t}\r\n\tsurroundingsIndexToCoords(index, x, y) {\r\n\t\t//returns as x,y\r\n\t\t/*console.log(\r\n\t\t\t`indx:${index},x=${x},y=${y}, return=${[\r\n\t\t\t\t(index % 5) - 2 + x,\r\n\t\t\t\tMath.floor(index / 5) - 2 + y\r\n\t\t\t]}`\r\n\t\t);*/\r\n\t\treturn [(index % 5) - 2 + x, Math.floor(index / 5) - 2 + y];\r\n\t}\r\n\tdisplay() {\r\n\t\tthis.displayFunc(\r\n\t\t\tthis.grid.map(row =>\r\n\t\t\t\trow.map(square =>\r\n\t\t\t\t\tsquare instanceof WorkerBotWrapper\r\n\t\t\t\t\t\t? [\"B\", square.color]\r\n\t\t\t\t\t\t: square\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n}\r\n","import Controller from \"./Controller.js\";\r\nlet eval2 = eval;\r\nonmessage = function(event) {\r\n\tlet botClasses = event.data.botClasses.map(func => eval2(`(${func})()`));\r\n\tlet controller = new Controller(\r\n\t\tbotClasses,\r\n\t\tgrid => {\r\n\t\t\tpostMessage([\"update\", grid]);\r\n\t\t},\r\n\t\tevent.data.rounds,\r\n\t\tevent.data.displayInterval\r\n\t);\r\n\tcontroller.runGame(results => {\r\n\t\tpostMessage([\"end\", results]);\r\n\t});\r\n};\r\n"],"names":["randInt","min","max","Math","floor","random","shuffle","array","i","length","j","temp","sleep","timeout","Promise","resolve","reject","setTimeout","WorkerBot","constructor","index","performAction","message","sendMessage","x","y","surroundings","ControllerBot","locations","storage","messages","WorkerBotWrapper","name","color","botClass","gold","bot","stunnedRound","undefined","alive","surrondings","STARTING_COINS","COINS_PER_ROUND","NUM_WORKER_BOTS","Controller","botClasses","displayFunc","rounds","displayInterval","filter","botClasses2","controllerBot","prototype","workerBot","runGame","initGrid","botnets","slice","runRound","sort","a","b","map","botnet","workerBots","reduce","join","round","console","log","generateCoin","error","warn","flatMap","allMessages","workerBot2","getSurroundings","controllerBotMessage","action","handleAction","stack","display","grid","Array","fill","push","generateWorkerBot","handleKill","handleMove","TypeError","param","includes","coords","surroundingsIndexToCoords","square","kill","find","workerBotClass","row","eval2","eval","onmessage","event","data","func","controller","postMessage","results"],"mappings":"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"}